<!DOCTYPE html>
<html>
<head>
    <title>Ziggy's World Tour: ULTRA HARD</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        body { margin: 0; display: flex; flex-direction: column; justify-content: center; align-items: center; height: 100vh; background: #ffe6e6; font-family: sans-serif; overflow: hidden; touch-action: manipulation; }
        #game-container { position: relative; width: 95vw; max-width: 600px; aspect-ratio: 3/2; }
        canvas { border: 4px solid #ff4d4d; border-radius: 15px; width: 100%; height: 100%; box-shadow: 0 10px 30px rgba(255, 77, 77, 0.3); background-color: #fff; }
        .ui { position: absolute; top: 15px; left: 20px; font-size: 24px; color: #ff4d4d; font-weight: bold; text-shadow: 1px 1px white; z-index: 10;}
        #location { position: absolute; top: 15px; right: 20px; font-size: 14px; color: #ff4d4d; font-weight: bold; background: rgba(255,255,255,0.8); padding: 5px 12px; border-radius: 20px; z-index: 10; border: 2px solid #ff4d4d; }
    </style>
</head>
<body>

    <div id="game-container">
        <div class="ui">Score: <span id="score">0</span></div>
        <div id="location">üìç where we started</div>
        <canvas id="gameCanvas"></canvas>
    </div>

    <script>
        const canvas = document.getElementById("gameCanvas");
        const ctx = canvas.getContext("2d");
        const scoreElement = document.getElementById("score");
        const locationTag = document.getElementById("location");

        canvas.width = 600;
        canvas.height = 400;

        const playerImg = new Image(); playerImg.src = 'https://i.postimg.cc/c42vC0N1/ziggy_ziggygame_0001.png'; 
        const obstacleImg = new Image(); obstacleImg.src = 'https://i.postimg.cc/25ZXqPS1/pixellab-a-slice-of-cheese-in-pixel-art-1770828928232.png';
        const collectibleImg = new Image(); collectibleImg.src = 'https://i.postimg.cc/ZY6MHtZz/pixellab-a-pixel-art-heart-1770821820174.png'; 

        const bgRISD = new Image(); bgRISD.src = 'https://i.postimg.cc/9XZc9QfF/IMG-5608.jpg';
        const bgJapan = new Image(); bgJapan.src = 'https://i.postimg.cc/gcXnTp2r/IMG-5608.jpg';
        const bgNYC = new Image(); bgNYC.src = 'https://i.postimg.cc/44qX7hGW/IMG-5608.jpg';
        const bgLA = new Image(); bgLA.src = 'https://i.postimg.cc/zGJD8Y8w/IMG-5608.jpg';

        let score = 0;
        let highScore = localStorage.getItem("ziggyHighScore") || 0;
        let isGameOver = false;
        let gameFrame = 0;
        let gameObjects = [];
        let nextSpawnFrame = 60; // Random spawn tracker

        const dino = { 
            x: 50, y: 300, width: 60, height: 60, dy: 0, 
            jumpForce: 14, // Stronger jump for hard mode
            gravityBase: 0.8, // Heavier gravity
            grounded: false, jumps: 0, maxJumps: 2 
        };

        const scenes = [
            { name: "üìç where we started", img: bgRISD, msg: "take me back to the start! ‚ù§Ô∏è" },
            { name: "üìç where we adventured", img: bgJapan, msg: "adventure is out there! üå∏" },
            { name: "üìç where our worlds collided", img: bgNYC, msg: "city lights & big hearts! üçé" },
            { name: "üìç where we became family", img: bgLA, msg: "home is whenever I'm with you! üå¥" }
        ];

        function handleAction() {
            if (isGameOver) { restart(); return; }
            if (dino.grounded || dino.jumps < dino.maxJumps) {
                dino.dy = -dino.jumpForce;
                dino.jumps++;
                dino.grounded = false;
            }
        }

        window.addEventListener("keydown", (e) => { if(e.code === "Space") handleAction(); });
        canvas.addEventListener("touchstart", (e) => { e.preventDefault(); handleAction(); }, {passive: false});

        function spawn() {
            const size = 42;
            const isObstacle = Math.random() > 0.3; 
            let yPos = isObstacle ? canvas.height - size - 40 : canvas.height - 130;
            gameObjects.push({ x: canvas.width, y: yPos, width: size, height: size, type: isObstacle ? 'obstacle' : 'heart' });
        }

        function update() {
            if (isGameOver) return;
            
            let diff = Math.floor(score / 35);
            let speed = 6.5 + (diff * 1.5); // Starts faster, jumps up 1.5 per level
            let grav = dino.gravityBase + (diff * 0.1);

            dino.dy += grav;
            dino.y += dino.dy;

            if (dino.y + dino.height > canvas.height - 40) {
                dino.y = canvas.height - 40 - dino.height;
                dino.dy = 0; dino.grounded = true; dino.jumps = 0;
            }

            // RANDOMIZED SPAWNING
            gameFrame++;
            if (gameFrame >= nextSpawnFrame) {
                spawn();
                // Random gap: at higher scores, the max gap gets much smaller
                let minGap = Math.max(25, 60 - (diff * 10));
                let maxGap = Math.max(40, 100 - (diff * 15));
                nextSpawnFrame = gameFrame + Math.floor(Math.random() * (maxGap - minGap) + minGap);
            }

            for (let i = gameObjects.length - 1; i >= 0; i--) {
                let o = gameObjects[i];
                o.x -= speed;

                if (dino.x < o.x + o.width - 15 && dino.x + dino.width - 15 > o.x && dino.y < o.y + o.height - 15 && dino.y + dino.height - 15 > o.y) {
                    if (o.type === 'obstacle') {
                        isGameOver = true;
                        if (score > highScore) { highScore = score; localStorage.setItem("ziggyHighScore", highScore); }
                    } else {
                        score += 10; gameObjects.splice(i, 1);
                        scoreElement.innerText = score;
                    }
                }
                if (o.x + o.width < -50) {
                    if (o.type === 'obstacle') { score++; scoreElement.innerText = score; }
                    gameObjects.splice(i, 1);
                }
            }
        }

        function draw() {
            const s = getCurrentScene();
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            if (s.img.complete) ctx.drawImage(s.img, 0, 0, canvas.width, 360);
            ctx.fillStyle = "#7f8c8d"; ctx.fillRect(0, canvas.height - 40, canvas.width, 40);

            ctx.drawImage(playerImg, dino.x, dino.y, dino.width, dino.height);
            gameObjects.forEach(o => ctx.drawImage(o.type === 'obstacle' ? obstacleImg : collectibleImg, o.x, o.y, o.width, o.height));

            locationTag.innerText = s.name;
            if (isGameOver) {
                ctx.fillStyle = "rgba(0,0,0,0.85)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
                ctx.fillStyle = "white"; ctx.textAlign = "center";
                ctx.font = "bold 28px sans-serif"; ctx.fillText(s.msg, canvas.width/2, 180);
                ctx.font = "20px sans-serif"; ctx.fillText("Score: " + score, canvas.width/2, 230);
            }
            update();
            requestAnimationFrame(draw);
        }

        function getCurrentScene() { return scenes[Math.floor(score / 35) % scenes.length]; }
        function restart() { score = 0; scoreElement.innerText = 0; gameObjects = []; isGameOver = false; dino.y = 200; gameFrame = 0; nextSpawnFrame = 60; }
        draw();
    </script>
</body>
</html>
