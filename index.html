// --- UPDATE THESE VARIABLES IN YOUR STATE SECTION ---
let baseSpeed = 5.5; // Slightly faster start
let gravityBase = 0.7;

function update() {
    if (isGameOver) return;
    
    // CALCULATE DIFFICULTY LEVEL
    let difficulty = Math.floor(score / 35); 
    
    // 1. INCREASE GRAVITY (Makes jumps feel "heavier" and faster)
    let currentGravity = gravityBase + (difficulty * 0.08);
    dino.dy += currentGravity;
    dino.y += dino.dy;

    if (dino.y + dino.height > canvas.height - 40) {
        dino.y = canvas.height - 40 - dino.height;
        dino.dy = 0;
        dino.grounded = true;
        dino.jumps = 0;
    }

    // 2. AGGRESSIVE SPEED (Noticeable jump every 35 points)
    let currentSpeed = baseSpeed + (difficulty * 1.2); 
    
    // 3. TIGHTER SPAWN GAPS (The cheese will come in quick waves)
    let currentSpawnGap = Math.max(35, 80 - (difficulty * 12));

    for (let i = gameObjects.length - 1; i >= 0; i--) {
        let obj = gameObjects[i];
        obj.x -= currentSpeed;

        // Collision logic
        if (dino.x < obj.x + obj.width - 15 && dino.x + dino.width - 15 > obj.x && dino.y < obj.y + obj.height - 15 && dino.y + dino.height - 15 > obj.y) {
            if (obj.type === 'obstacle') {
                isGameOver = true;
                if (score > highScore) { highScore = score; localStorage.setItem("ziggyHighScore", highScore); }
            } else if (!obj.counted) {
                score += 10; obj.counted = true;
                gameObjects.splice(i, 1);
                scoreElement.innerText = score;
            }
        }

        if (obj.x + obj.width < -20) {
            gameObjects.splice(i, 1);
            if (obj.type === 'obstacle') { score++; scoreElement.innerText = score; }
        }
    }

    gameFrame++;
    if (gameFrame % Math.floor(currentSpawnGap) === 0) {
        spawnGameObject();
    }
}

// Slightly smaller hitbox for the obstacles to keep it fair at high speeds
function spawnGameObject() {
    const size = 42; 
    const isObstacle = Math.random() > 0.35; // Slightly more obstacles than hearts
    let yPos = canvas.height - size - 40;
    if (!isObstacle) yPos -= 90; // Hearts float a bit higher
    gameObjects.push({ x: canvas.width, y: yPos, width: size, height: size, type: isObstacle ? 'obstacle' : 'collectible', counted: false });
}
